---
lab:
    title: '24 - アプリにアプリ ロールを追加してトークンで受け取る'
    learning path: '03'
    module: 'モジュール 03 - アプリの登録を実装する'
---

# ラボ 24: アプリにアプリ ロールを追加してトークンで受け取る

## ラボ シナリオ

ロールベースのアクセス制御 (RBAC) は、アプリケーションにおいて承認を実施する一般的なメカニズムです。RBAC を使用するとき、管理者は、個々のユーザーまたはグループではなく、ロールにアクセス許可を付与します。その後、管理者はロールをさまざまなユーザーやグループに割り当てて、コンテンツや機能にだれがアクセスできるかを制御できます。あなたは、RBAC ロールの実装を計画しており、手順の実行方法を理解していることを確認する必要があります。

#### 推定時間: 10 分

## アプリ ロール UI を使用してアプリ ロールを宣言する

>[!重要]
>アプリ ロールのポータル UI 機能はパブリック プレビュー段階です。このプレビュー版はサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。特定の機能はサポート対象ではないか、機能が制限されることがあります。

Azure portal のユーザー インターフェイスを使用してアプリ ロールを作成するには、次のようにします。

1. グローバル管理者アカウントを使用して、[https://portal.azure.com](https://portal.azure.com) にサインインします。

2. ポータル メニューを開き、**「Azure Active Directory」** を選択します。

3. **「Azure Active Directory」** ブレードの **「管理」** の下にある **「アプリの登録」** を選択します。

4. 以前に作成した「**Demo App**」アプリの登録項目を選択します。

5. **「アプリ ロール」** を選択し、**「アプリ ロールの作成」** を選択します。

    ![アプリ ロールの作成が強調表示されているアプリ ロールを示す画面イメージ](./media/lp3-mod3-app-roles-create-app-role.png)

6. **「アプリ ロールの作成」** ウィンドウの **「表示名」** ボックスに **「アンケート ライター」** と入力します。

7. **「メンバーの種類を許可」** で、**「ユーザーまたはグループ」** を選択します。

8. **「値」** ボックスに **「Survey.Create」** と入力します。

9. **「説明」** ボックスに、**「ライターはアンケートを作成できます」** と入力します。

10. 説明は必須のフィールドであることに注意してください。

11. **「このアプリ ロールを有効にしますか」** が選択されていることを確認してから、**「適用」** を選択します。

## ロールにユーザーとグループを割り当てる

アプリケーションにアプリ ロールを追加したら、それらのロールにユーザーとグループを割り当てることができます。ポータルの UI から、または [https://docs.microsoft.com/graph/api/user-post-approleassignments](https://docs.microsoft.com/graph/api/user-post-approleassignments) を使用してプログラミングによって、ユーザーとグループをロールに割り当てます。さまざまなアプリのロールに割り当てられたユーザーがアプリケーションにサインインすると、roles 要求で割り当てられたロールがトークンに付与されます。

Azure portal を使用してロールにユーザーとグループを割り当てるには、次のようにします。

1. [https://portal.azure.com](https://portal.azure.com) にサインインします。

2. Azure Active Directory の左側にあるナビゲーション メニューで、**「エンタープライズ アプリケーション」** を選択します。

3. **「すべてのアプリケーション」** リストで **「Demo App」** を選択します。

5. **「管理」** で **「ユーザーとグループ」** を選択します。

6. メニューで、**「+ ユーザーまたはグループの追加」** をクリックします。

7. 「ユーザーとグループ」の下の **「選択されていません」** をクリックします。

8. ユーザーとセキュリティ グループの一覧が表示されます。 **「Grady」** を検索して、「Grady Archie」を追加します。

9. **「選択」** をクリックします。

10. **「ロールの割り当ての選択」** で、**「アンケート ライター」** が選択されていることを確認します。

    **注** - アンケート ライター しかないため、このオプションは灰色で表示されます。

11. **「割り当て」** を選択して、アプリへのユーザーとグループの割り当てを終了します。

12. 追加したユーザーとグループが **「ユーザーとグループ」** のリストに表示されることを確認します。

## Graph Explorer を使用して、Gredy に割り当てられたロールを確認する

1. Graph Exploer https://developer.microsoft.com/ja-jp/graph/graph-explorer にアクセスします。

1. 左側の認証ボタンをクリックして、Grady のアカウントで認証します。

1. **要求されているアクセス許可** で内容を確認し、**承諾** をクリックします。これにより、ユーザーの個人情報に対して、Graph Explorer がアクセス可能になります。

1. 画面の「GET」の横にある URL に、https://graph.microsoft.com/v1.0/me/appRoleAssignments を指定して、**クエリの実行** をクリックします。

1.**応答プレビュー** ウィンドウに Demo App から与えられたアプリケーションロールが表示されていることを確認します。 **appRoleId** が、DemoApp で登録した**アンケート ライター** ロールの識別子です。





